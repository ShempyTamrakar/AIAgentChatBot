<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>Yondr Data Center Chatbot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --yondr-dark-gray: #333333;
            --yondr-orange: #FF4713;
            --yondr-white: #FFFFFF;
            --yondr-light-gray: #F5F5F5;
            --yondr-medium-gray: #CCCCCC;
        }
        
        html, body {
            overflow-x: hidden; /* Prevent horizontal scrolling */
            max-width: 100vw; /* Ensure content doesn't exceed viewport width */
            box-sizing: border-box; /* Include padding and border in element width */
        }
        
        *, *:before, *:after {
            box-sizing: inherit; /* Ensure all elements inherit box-sizing */
        }
        
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: var(--yondr-white);
            font-family: Arial, sans-serif;
            position: relative;
            color: var(--yondr-dark-gray);
            padding: 0;
            margin: 0;
            width: 100%;
        }
        
        .container {
            flex: 1 0 auto;
            margin-top: 0;
            margin-bottom: 2rem;
            padding-bottom: 80px; /* Space for chatbot button */
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .main-content {
            padding: 2rem;
        }
        
        footer {
            flex-shrink: 0;
            padding: 1rem 0;
            margin-top: auto;
            background-color: var(--yondr-dark-gray);
            color: var(--yondr-white);
        }
        
        /* Chatbot styles */
        .chat-bubble {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            background: none !important;
            border: none !important;
            box-shadow: none !important;
        }
        
        .chat-bubble:hover {
            transform: scale(1.1);
        }
        
        .chat-bubble .robot-icon {
            width: 100%;
            height: 100%;
            object-fit: contain;
            /* Remove watermarks in the image */
            background-color: transparent;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-5px) rotate(-2deg);
            }
            50% {
                transform: translateY(-8px) rotate(0deg);
            }
            75% {
                transform: translateY(-5px) rotate(2deg);
            }
        }
        
        .chat-bubble .robot-icon {
            animation: float 4s ease-in-out infinite;
        }
        
        .chat-popup {
            display: none;
            position: fixed;
            bottom: 110px;
            right: 20px;
            width: 350px;
            background-color: var(--yondr-white);
            border-radius: 16px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            z-index: 1001;
            flex-direction: column;
            max-height: 70vh;
        }
        
        /* Responsive adjustments for the chat popup */
        @media (max-width: 768px) {
            .chat-popup {
                width: calc(100% - 40px); /* Full width minus some margins */
                bottom: 80px;
                right: 20px;
                left: 20px;
                max-height: 80vh;
            }
            
            .examples-dropdown {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                bottom: calc(80px + 80px); /* Above the chat popup */
            }
        }
        
        .chat-popup-header {
            background-color: var(--yondr-dark-gray);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--yondr-medium-gray);
            color: var(--yondr-white);
        }
        
        .chat-popup-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .avatar-container {
            display: flex;
            align-items: center;
        }
        
        /* Robot avatar in header */
        .robot-avatar-small {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            background-color: transparent;
        }
        
        .close-chat {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: var(--yondr-white);
        }
        
        .chat-popup-body {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: var(--yondr-white);
            max-height: 50vh;
        }
        
        .chat-popup-footer {
            padding: 10px 15px;
            background-color: var(--yondr-light-gray);
            border-top: 1px solid var(--yondr-medium-gray);
        }
        
        .chat-message {
            margin-bottom: 12px;
            max-width: 85%;
            padding: 10px 12px;
            border-radius: 16px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        
        .user-message {
            background-color: var(--yondr-orange);
            color: var(--yondr-white);
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        
        .bot-message {
            background-color: var(--yondr-light-gray);
            color: var(--yondr-dark-gray);
            border-bottom-left-radius: 4px;
        }
        
        /* Enhanced styling for tables in bot messages */
        .bot-message table {
            width: 100%;
            margin: 10px 0;
            border-collapse: collapse;
            background-color: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .bot-message table th {
            background-color: var(--yondr-orange);
            color: white;
            padding: 8px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
        }
        
        .bot-message table td {
            padding: 6px 8px;
            border-bottom: 1px solid var(--yondr-light-gray);
            font-size: 12px;
        }
        
        .bot-message table tr:last-child td {
            border-bottom: none;
        }
        
        .bot-message table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        /* Highlight important data points */
        .bot-message strong {
            color: var(--yondr-orange);
            font-weight: 600;
        }
        
        /* Styled lists in bot messages */
        .bot-message ul, .bot-message ol {
            padding-left: 20px;
            margin: 10px 0;
        }
        
        .bot-message li {
            margin-bottom: 5px;
        }
        
        /* Code or technical information */
        .bot-message code {
            background-color: rgba(0,0,0,0.05);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
        
        /* Data visualization placeholder - for future implementation */
        .data-visualization {
            width: 100%;
            height: 180px;
            background-color: white;
            border-radius: 6px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--yondr-medium-gray);
            border: 1px solid var(--yondr-light-gray);
        }
        
        .initial-bubble {
            position: fixed;
            right: 110px;
            bottom: 40px;
            background-color: var(--yondr-white);
            padding: 10px 15px;
            border-radius: 18px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            max-width: 220px;
            display: none; /* Initially hidden */
            z-index: 999;
            font-size: 14px;
        }
        
        /* Chat input area */
        .chat-input-container {
            display: flex;
            padding: 10px 15px;
            background-color: var(--yondr-light-gray);
            border-top: 1px solid var(--yondr-medium-gray);
        }
        
        .chat-input {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid var(--yondr-medium-gray);
            border-radius: 20px;
            background-color: var(--yondr-white);
            outline: none;
            resize: none;
        }
        
        .send-button {
            width: 36px;
            height: 36px;
            margin-left: 8px;
            border-radius: 50%;
            background-color: var(--yondr-orange);
            color: var(--yondr-white);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }
        
        /* Tab navigation */
        .chat-tabs {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            background-color: var(--yondr-white);
            border-top: 1px solid var(--yondr-medium-gray);
        }
        
        .chat-tab {
            padding: 8px 0;
            text-align: center;
            flex-grow: 1;
            color: var(--yondr-dark-gray);
            font-size: 12px;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .chat-tab i {
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .chat-tab.active {
            color: var(--yondr-orange);
        }
        
        /* Welcome message bubble animation */
        @keyframes bubble-float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        
        .initial-bubble {
            animation: bubble-float 3s ease-in-out infinite;
            transition: opacity 0.5s ease-in-out;
        }
        
        /* Examples dropdown */
        .examples-dropdown {
            position: fixed;
            bottom: 130px; /* Positioned directly above the button */
            right: 20px; /* Aligned with the button */
            width: 300px;
            background-color: var(--yondr-white);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: none;
            z-index: 9999;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        
        .examples-dropdown h6 {
            font-size: 14px;
            margin: 0 0 8px 0;
            color: var(--yondr-dark-gray);
            font-weight: bold;
        }
        
        .examples-dropdown ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .examples-dropdown li {
            padding: 5px 0;
        }
        
        .example-question {
            text-decoration: none;
            color: var(--yondr-orange);
            font-size: 13px;
            cursor: pointer;
        }
        
        .example-question:hover {
            text-decoration: underline;
        }
        
        /* Voice Interface Styles */
        .chat-interface {
            display: none;
            flex-direction: column;
            height: 100%;
        }
        
        .chat-interface.active {
            display: flex;
        }
        
        .voice-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .voice-robot-container {
            position: relative;
            width: 140px;
            height: 140px;
            margin-bottom: 20px;
        }
        
        .voice-robot-avatar {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            overflow: hidden;
            background-color: #f0f5ea;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 2;
            margin: 10px auto;
        }
        
        .robot-voice-avatar {
            width: 90%;
            height: 90%;
            object-fit: contain;
        }
        
        .voice-animation-outer {
            position: absolute;
            top: 0;
            left: 0;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voice-animation-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle, transparent 40%, transparent 40%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .voice-animation-particles::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'%3E%3Cg fill='none' stroke='%23FF4713' stroke-width='1'%3E%3Ccircle cx='70' cy='70' r='65'/%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.7;
        }
        
        .voice-animation-particles::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'%3E%3Cg fill='none'%3E%3Ccircle cx='70' cy='70' r='60' stroke='%23FF4713' stroke-width='0.5' stroke-dasharray='2,2' /%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
        }
        
        /* Add particle dots around the circle */
        .voice-animation-active .voice-animation-particles {
            position: relative;
        }
        
        .voice-animation-active .voice-animation-particles::before,
        .voice-animation-active .voice-animation-particles::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 1;
        }
        
        /* Create the dots animation */
        @keyframes moveDots {
            0%, 100% { opacity: 0.4; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        
        .voice-animation-active .voice-robot-container::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            z-index: 0;
            background-image: 
                radial-gradient(circle 2px at 20% 30%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 1px at 30% 65%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 2px at 40% 10%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 2px at 50% 80%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 1px at 60% 20%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 2px at 70% 60%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 1px at 80% 40%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 2px at 90% 70%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 1px at 15% 50%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 2px at 35% 70%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 1px at 55% 35%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 2px at 75% 50%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 1px at 95% 25%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 2px at 10% 90%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 1px at 25% 15%, var(--yondr-orange) 100%, transparent 0),
                radial-gradient(circle 2px at 45% 85%, var(--yondr-orange) 100%, transparent 0);
            opacity: 0.6;
            animation: moveDots 3s infinite alternate;
        }
        
        .voice-animation-active .voice-animation-particles::after {
            animation: rotate 10s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .voice-animation-active .voice-animation-particles {
            opacity: 1;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.05);
                opacity: 1;
            }
            100% {
                transform: scale(0.95);
                opacity: 0.7;
            }
        }
        
        .voice-title {
            margin-bottom: 15px;
        }
        
        .voice-title h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--yondr-dark-gray);
        }
        
        .ai-badge {
            display: inline-block;
            background-color: var(--yondr-orange);
            color: white;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 4px;
            margin-left: 5px;
            vertical-align: top;
        }
        
        .voice-title p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }
        
        .voice-status {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .voice-time {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .voice-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .voice-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }
        
        .voice-button:hover {
            transform: scale(1.05);
        }
        
        .record-button {
            background-color: var(--yondr-orange);
            color: white;
        }
        
        .stop-button {
            background-color: #ff3b30;
            color: white;
        }
        
        .speak-button {
            background-color: #4a90e2;
            color: white;
            margin-left: 10px;
            font-size: 18px;
        }
        
        .voice-messages {
            padding: 15px;
            overflow-y: auto;
            background-color: var(--yondr-light-gray);
            flex-grow: 1;
            border-top: 1px solid var(--yondr-medium-gray);
        }
        
        .talking-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--yondr-orange);
            margin-left: 5px;
            margin-right: 3px;
            opacity: 0.5;
        }
        
        .talking .talking-dot {
            animation: pulseDot 1s infinite;
        }
        
        .talking .talking-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .talking .talking-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes pulseDot {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Main content styling - Yondr theme */
        .page-header {
            text-align: left;
            margin-bottom: 3rem;
            padding-top: 4rem;
        }
        
        .page-header h1 {
            font-weight: bold;
            color: var(--yondr-dark-gray);
            margin-bottom: 0;
            font-size: 3.5rem;
            text-transform: uppercase;
            line-height: 1;
        }
        
        .page-header .subtitle {
            font-size: 3.5rem;
            color: var(--yondr-dark-gray);
            font-weight: bold;
            line-height: 1.2;
            text-transform: uppercase;
        }
        
        .page-header .tagline {
            font-size: 3.5rem;
            color: var(--yondr-orange);
            font-weight: bold;
            line-height: 1.2;
            text-transform: uppercase;
        }
        
        /* Responsive design for smaller screens */
        @media (max-width: 992px) {
            .page-header h1,
            .page-header .subtitle,
            .page-header .tagline {
                font-size: 3rem;
            }
        }
        
        @media (max-width: 768px) {
            .page-header h1,
            .page-header .subtitle,
            .page-header .tagline {
                font-size: 2.5rem;
            }
            
            .system-card {
                min-width: 100%;
                margin-bottom: 1rem;
            }
            
            .chat-popup {
                width: 90%;
                right: 5%;
                left: 5%;
                max-width: none;
                bottom: 70px;
            }
        }
        
        @media (max-width: 576px) {
            .page-header h1,
            .page-header .subtitle,
            .page-header .tagline {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .examples-dropdown {
                width: 250px;
            }
        }
        
        .page-header .tomorrow-text {
            color: #de9951;
            font-size: 1.2rem;
            margin-top: 1rem;
        }
        
        .page-header .constraints-text {
            color: var(--yondr-dark-gray);
            font-size: 1.2rem;
        }
        
        .system-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            margin-top: 4rem;
        }
        
        .system-card {
            background-color: var(--yondr-white);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            flex: 1;
            min-width: 250px;
            max-width: 350px;
            transition: transform 0.2s;
            border: 1px solid var(--yondr-medium-gray);
        }
        
        .system-card:hover {
            transform: translateY(-5px);
            border-color: var(--yondr-orange);
        }
        
        .system-card h3 {
            color: var(--yondr-dark-gray);
            margin-top: 0;
            border-bottom: 2px solid var(--yondr-orange);
            padding-bottom: 0.5rem;
            font-weight: bold;
        }
        
        #help-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 8px 16px;
            background-color: var(--yondr-orange);
            color: var(--yondr-white);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-weight: bold;
        }
        
        .navbar {
            background-color: var(--yondr-white);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0.5rem 0;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: var(--yondr-dark-gray);
            font-size: 1.5rem;
        }
        
        .navbar-brand img {
            height: 40px;
        }
        
        .nav-link {
            color: var(--yondr-dark-gray) !important;
            font-weight: 500;
            margin: 0 10px;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        .nav-link:hover, .nav-link:focus {
            color: var(--yondr-orange) !important;
        }
        
        .btn-primary {
            background-color: var(--yondr-orange);
            border-color: var(--yondr-orange);
        }
        
        .btn-primary:hover, .btn-primary:focus {
            background-color: #e03e10;
            border-color: #e03e10;
        }
        
        .investor-portal {
            background-color: var(--yondr-orange);
            color: white !important;
            padding: 0.5rem 1rem !important;
            border-radius: 0;
            margin-left: 20px;
        }
        
        .investor-portal:hover {
            background-color: #e03e10;
            color: white !important;
        }
        
        .products-link {
            position: relative;
            margin-right: 2rem;
        }
        
        .products-arrow {
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--yondr-orange);
        }
        
        .why-yondr-link {
            position: relative;
            margin-right: 2rem;
        }
        
        .why-yondr-arrow {
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--yondr-orange);
        }
        
        /* Table styling */
        .yondr-data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 20px 0;
            font-size: 0.95em;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            background-color: white;
        }
        
        .yondr-data-table thead tr {
            background-color: var(--yondr-orange);
            color: #ffffff;
            text-align: left;
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        
        .yondr-data-table th,
        .yondr-data-table td {
            padding: 14px 18px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .yondr-data-table th {
            border-bottom: 2px solid #c83a10;
        }
        
        .yondr-data-table tbody tr {
            transition: background-color 0.3s;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .yondr-data-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .yondr-data-table tbody tr:nth-of-type(even) {
            background-color: #f9f9f9;
        }
        
        .yondr-data-table tbody tr:hover {
            background-color: #f0f4f8;
        }
        
        /* Force table width to 100% */
        table.yondr-data-table {
            table-layout: fixed;
            width: 100% !important;
        }
        
        /* Set column widths */
        .yondr-data-table th,
        .yondr-data-table td {
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-word;
        }
        
        /* Make tables responsive */
        @media screen and (max-width: 768px) {
            .yondr-data-table {
                display: block;
                overflow-x: auto;
            }
            
            .yondr-data-table th,
            .yondr-data-table td {
                white-space: nowrap;
            }
        }
        
        /* Style for bot messages containing tables */
        .bot-message .yondr-data-table {
            max-width: 100%;
            margin: 12px 0;
        }
        
        /* For text-based tables in bot messages */
        .bot-message pre {
            white-space: pre-wrap;
            word-break: break-word;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <img src="https://yondrgroup.com/wp-content/themes/yondr/assets/images/logo-orange.svg" alt="Yondr">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a href="#" class="nav-link">ABOUT US</a></li>
                        <li class="nav-item"><a href="#" class="nav-link">LOCATIONS</a></li>
                        <li class="nav-item">
                            <a href="#" class="nav-link products-link">PRODUCTS
                                <span class="products-arrow">→</span>
                            </a>
                        </li>
                        <li class="nav-item"><a href="#" class="nav-link">OUR PEOPLE</a></li>
                        <li class="nav-item"><a href="#" class="nav-link">INTEL</a></li>
                        <li class="nav-item"><a href="#" class="nav-link">NEWSROOM</a></li>
                        <li class="nav-item"><a href="#" class="nav-link">JOIN US</a></li>
                        <li class="nav-item"><a href="#" class="nav-link">CONTACT</a></li>
                        <li class="nav-item"><a href="#" class="nav-link investor-portal">INVESTOR PORTAL</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="main-content">
            <div class="page-header">
                <h1>HYPERSCALE</h1>
                <div class="subtitle">DATA CENTERS</div>
                <div class="tagline">TAILORED TO YOU.</div>
                <p class="tomorrow-text">tomorrow <span class="constraints-text">without constraints</span></p>
                
                <div class="mt-4">
                    <a href="#" class="text-decoration-none">
                        <span class="products-link me-3 text-dark">PRODUCTS</span>
                        <span class="products-arrow text-danger">→</span>
                    </a>
                    <a href="#" class="text-decoration-none ms-4">
                        <span class="why-yondr-link me-3 text-dark">WHY YONDR</span>
                        <span class="why-yondr-arrow text-danger">→</span>
                    </a>
                </div>
            </div>
            
            <div class="system-cards">
                <div class="system-card">
                    <h3>Data Centers</h3>
                    <p>We operate hyperscale data centers across multiple regions, providing robust and sustainable infrastructure for our global clients.</p>
                    <p>Total Power Capacity: 23,000 kW</p>
                </div>
                
                <div class="system-card">
                    <h3>Server Infrastructure</h3>
                    <p>Our server fleet consists of high-performance, energy-efficient equipment to support mission-critical business operations.</p>
                    <p>Server Count: 15 active servers</p>
                </div>
                
                <div class="system-card">
                    <h3>Network Connectivity</h3>
                    <p>Redundant network pathways ensure 99.99% uptime across all services with enhanced security protocols.</p>
                    <p>Network Devices: Various switches and routers</p>
                </div>
            </div>
            
            <p class="text-center mt-5">Use our AI assistant in the bottom right to query specific information about our data centers and servers.</p>
        </div>
    </div>
    
    <!-- Chatbot components -->
    <div class="initial-bubble" id="initialBubble">
        Hi! How can I assist you with our data centers?
    </div>
    
    <div class="chat-bubble" id="chatButton">
        <img src="/static/images/yondr_robot.png?v=1" alt="AI Robot Assistant" class="robot-icon">
    </div>
    
    <div class="chat-popup" id="chatPopup">
        <div class="chat-popup-header">
            <div class="avatar-container">
                <img src="/static/images/yondr_robot.png?v=1" alt="AI Robot Assistant" class="robot-avatar-small">
                <h3>YONDR Data Center AI</h3>
            </div>
            <button class="close-chat" id="closeChat">✕</button>
        </div>

        <!-- Text Chat Interface -->
        <div id="textChatInterface" class="chat-interface active">
            <div class="chat-popup-body" id="chatMessages">
                <div class="chat-message bot-message">
                    Hello! I'm here to help with your information request. What would you like to know about our hyperscale data centers?
                </div>
                
                {% for message in chat_history %}
                    <div class="chat-message user-message">{{ message.user }}</div>
                    <div class="chat-message bot-message">{{ message.bot }}</div>
                {% endfor %}
            </div>
            
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="userInput" placeholder="Type here...">
                <button class="send-button" id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <!-- Voice Chat Interface -->
        <div id="voiceChatInterface" class="chat-interface">
            <div class="voice-container">
                <div class="voice-robot-container">
                    <div class="voice-animation-outer" id="voiceAnimationOuter">
                        <div class="voice-animation-particles" id="voiceAnimationParticles"></div>
                    </div>
                    <div class="voice-robot-avatar">
                        <img src="/static/images/yondr_robot.png?v=1" alt="YONDR Robot" class="robot-voice-avatar">
                    </div>
                </div>
                
                <div class="voice-title">
                    <h3>Data Center Assistant<span class="ai-badge">AI</span></h3>
                    <p>Ask me anything about your data centers</p>
                </div>
                
                <div class="voice-status">
                    <div id="voiceStatusText">Ready to listen</div>
                    <div id="voiceTime" class="voice-time">00:00</div>
                </div>
                
                <div class="voice-controls">
                    <button id="startRecording" class="voice-button record-button">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button id="stopRecording" class="voice-button stop-button" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                    <button id="speakResponse" class="voice-button speak-button" title="Speak last response">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            </div>
            
            <div id="voiceMessages" class="voice-messages">
                <!-- Voice transcription and responses will be shown here -->
            </div>
        </div>
        
        <div class="chat-tabs">
            <a href="#" class="chat-tab active" id="chat-tab">
                <i class="fas fa-comments"></i>
                <span>Chat</span>
            </a>
            <a href="#" class="chat-tab" id="voice-tab">
                <i class="fas fa-microphone"></i>
                <span>Voice</span>
            </a>
        </div>
    </div>
    
    <div class="examples-dropdown" id="examplesDropdown">
        <div class="row">
            <div class="col-12">
                <h6>Data Center Questions</h6>
                <ul>
                    <li><a href="#" class="example-question">How many data centers do we have?</a></li>
                    <li><a href="#" class="example-question">List all data centers</a></li>
                    <li><a href="#" class="example-question">Tell me about the London data center</a></li>
                    <li><a href="#" class="example-question">Which data center has the most servers?</a></li>
                </ul>
            </div>
            <div class="col-12 mt-2">
                <h6>Server Questions</h6>
                <ul>
                    <li><a href="#" class="example-question">How many servers do we have in total?</a></li>
                    <li><a href="#" class="example-question">Which servers are in the New York data center?</a></li>
                    <li><a href="#" class="example-question">What servers had maintenance in 2023?</a></li>
                    <li><a href="#" class="example-question">Which servers have never had maintenance?</a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <button id="help-button">Examples</button>
    
    <footer class="py-4 text-center">
        <div class="container">
            <div class="row">
                <div class="col-md-4 text-md-start">
                    <h5 class="text-uppercase mb-3" style="color: var(--yondr-orange);">YONDR Group</h5>
                    <p>Hyperscale data centers tailored to you</p>
                </div>
                <div class="col-md-4">
                    <h5 class="text-uppercase mb-3" style="color: var(--yondr-orange);">Connect</h5>
                    <div class="d-flex justify-content-center gap-3">
                        <a href="#" class="text-light"><i class="fab fa-linkedin fa-lg"></i></a>
                        <a href="#" class="text-light"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="text-light"><i class="fab fa-facebook fa-lg"></i></a>
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <p class="mb-0">© 2025 YONDR Group. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Force image reload
            const robotImages = document.querySelectorAll('img[src*="yondr_robot.png"]');
            robotImages.forEach(img => {
                const currentSrc = img.src;
                img.src = '';
                setTimeout(() => {
                    img.src = currentSrc + '&t=' + new Date().getTime();
                }, 50);
            });
            
            const chatButton = document.getElementById('chatButton');
            const chatPopup = document.getElementById('chatPopup');
            const closeChat = document.getElementById('closeChat');
            const initialBubble = document.getElementById('initialBubble');
            const chatMessages = document.getElementById('chatMessages');
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            const helpButton = document.getElementById('help-button');
            const examplesDropdown = document.getElementById('examplesDropdown');
            const exampleQuestions = document.querySelectorAll('.example-question');
            
            // Show the initial bubble after a delay
            setTimeout(() => {
                initialBubble.style.display = 'block';
            }, 2000);
            
            // Toggle chat popup
            chatButton.addEventListener('click', () => {
                chatPopup.style.display = chatPopup.style.display === 'flex' ? 'none' : 'flex';
                initialBubble.style.display = 'none';
                
                // Clear any existing chat messages except the first welcome message
                while (chatMessages.children.length > 1) {
                    chatMessages.removeChild(chatMessages.lastChild);
                }
                
                scrollToBottom();
            });
            
            // Close chat popup
            closeChat.addEventListener('click', () => {
                chatPopup.style.display = 'none';
            });
            
            // Toggle examples dropdown with improved functionality
            helpButton.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent event from bubbling up
                // Toggle visibility
                if (examplesDropdown.style.display === 'block') {
                    examplesDropdown.style.display = 'none';
                } else {
                    examplesDropdown.style.display = 'block';
                    // Add a small animation to make it more noticeable
                    examplesDropdown.style.opacity = '0';
                    examplesDropdown.style.transform = 'translateY(10px)';
                    setTimeout(() => {
                        examplesDropdown.style.opacity = '1';
                        examplesDropdown.style.transform = 'translateY(0)';
                    }, 10);
                }
            });
            
            // Hide examples dropdown when clicking elsewhere
            document.addEventListener('click', (event) => {
                if (examplesDropdown.style.display === 'block' && 
                    !examplesDropdown.contains(event.target) && 
                    event.target !== helpButton) {
                    examplesDropdown.style.display = 'none';
                }
            });
            
            // Scroll to the bottom of the chat
            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Add a user message to the chat
            function addUserMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message user-message';
                messageDiv.textContent = message;
                chatMessages.appendChild(messageDiv);
                scrollToBottom();
            }
            
            // Add a bot message to the chat with enhanced formatting
            function addBotMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message bot-message';
                
                // Check if the message contains table-like data and format it
                const formattedMessage = formatBotMessage(message);
                messageDiv.innerHTML = formattedMessage;
                
                chatMessages.appendChild(messageDiv);
                scrollToBottom();
            }
            
            // Format the bot's message for better presentation
            function formatBotMessage(message) {
                // Format tables: Detect patterns that look like tabular data
                let formattedMessage = message;
                
                // Check for SQL-like table results
                if (message.includes('|') && (message.includes('\n') || message.includes('<br>'))) {
                    try {
                        // Split by lines
                        const lines = message.split(/\n|<br>/);
                        let foundTable = false;
                        let tableLines = [];
                        
                        for (let i = 0; i < lines.length; i++) {
                            if (lines[i].includes('|') && !foundTable) {
                                foundTable = true;
                                tableLines = [];
                            }
                            
                            if (foundTable && lines[i].includes('|')) {
                                tableLines.push(lines[i]);
                            } else if (foundTable && tableLines.length > 0) {
                                // End of table detected, convert to HTML table
                                const tableHtml = convertToHtmlTable(tableLines);
                                formattedMessage = formattedMessage.replace(
                                    tableLines.join('\n'), 
                                    tableHtml
                                );
                                foundTable = false;
                            }
                        }
                        
                        // In case the table is at the end of the message
                        if (foundTable && tableLines.length > 0) {
                            const tableHtml = convertToHtmlTable(tableLines);
                            formattedMessage = formattedMessage.replace(
                                tableLines.join('\n'), 
                                tableHtml
                            );
                        }
                    } catch (e) {
                        console.error('Error formatting table:', e);
                    }
                }
                
                // Format bullet points
                formattedMessage = formattedMessage.replace(/^\s*\*\s(.+)/gm, '<li>$1</li>');
                formattedMessage = formattedMessage.replace(/(<li>.+<\/li>)+/g, '<ul>$&</ul>');
                
                // Format important data points with bold tags
                formattedMessage = formattedMessage.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
                
                // Format code or technical info
                formattedMessage = formattedMessage.replace(/`([^`]+)`/g, '<code>$1</code>');
                
                return formattedMessage;
            }
            
            // Convert a text table to HTML table
            function convertToHtmlTable(tableLines) {
                console.log("Converting to HTML table:", tableLines);
                let html = '<div class="table-responsive"><table class="yondr-data-table">';
                let hasHeader = false;
                
                // Check if there's a separator line to determine if there's a header
                for (let i = 0; i < tableLines.length; i++) {
                    if (tableLines[i].replace(/[\-|]+/g, '') === '') {
                        hasHeader = true;
                        break;
                    }
                }
                
                // Process table rows
                let rowIndex = 0;
                
                for (let i = 0; i < tableLines.length; i++) {
                    // Skip separator line if it exists (e.g., |------|------|)
                    if (tableLines[i].replace(/[\-|]+/g, '') === '') continue;
                    
                    const cells = tableLines[i].split('|').map(cell => cell.trim()).filter(cell => cell !== '');
                    
                    // If this is the first row and we have a header separator, it's a header row
                    if (rowIndex === 0 && hasHeader) {
                        html += '<thead><tr>';
                        cells.forEach(cell => {
                            html += `<th>${cell}</th>`;
                        });
                        html += '</tr></thead><tbody>';
                    } else {
                        // If it's the first row and we don't have a header, start the tbody
                        if (rowIndex === 0) {
                            html += '<tbody>';
                        }
                        html += '<tr>';
                        cells.forEach(cell => {
                            // Format numbers in cells
                            if (!isNaN(cell) && !cell.includes(' ')) {
                                html += `<td class="text-right">${cell}</td>`;
                            } else {
                                html += `<td>${cell}</td>`;
                            }
                        });
                        html += '</tr>';
                    }
                    
                    rowIndex++;
                }
                
                html += '</tbody></table></div>';
                return html;
            }
            
            // Send a message to the server and handle the response
            function sendMessage(message) {
                // Add the user message to the chat
                addUserMessage(message);
                
                // Clear the input field
                userInput.value = '';
                
                // Send the message to the server
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: message })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        addBotMessage('Sorry, an error occurred: ' + data.error);
                    } else {
                        addBotMessage(data.response);
                        
                        // If we're in voice mode, also trigger voice response
                        if (document.getElementById('voiceChatInterface').classList.contains('active')) {
                            addVoiceResponse(data.response);
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    addBotMessage('Sorry, an error occurred while processing your request.');
                });
            }
            
            // Handle sending a message
            function handleSend() {
                const message = userInput.value.trim();
                if (message) {
                    sendMessage(message);
                }
            }
            
            // Clear the chat history
            function clearChat() {
                fetch('/clear_history', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    // Clear the chat messages (except the welcome message)
                    while (chatMessages.children.length > 1) {
                        chatMessages.removeChild(chatMessages.lastChild);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
            
            // Event listener for Send button
            sendButton.addEventListener('click', handleSend);
            
            // Event listener for Enter key
            userInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    handleSend();
                }
            });
            
            // Event listeners for example questions
            exampleQuestions.forEach(question => {
                question.addEventListener('click', function(event) {
                    event.preventDefault();
                    chatPopup.style.display = 'flex';
                    examplesDropdown.style.display = 'none';
                    userInput.value = this.textContent;
                    handleSend();
                });
            });
            
            // Scroll to the bottom of the chat on page load
            scrollToBottom();
            
            // ----- Voice Interface Functionality ----- //
            console.log("Initializing voice interface...");
            const chatTab = document.getElementById('chat-tab');
            const voiceTab = document.getElementById('voice-tab');
            const textChatInterface = document.getElementById('textChatInterface');
            const voiceChatInterface = document.getElementById('voiceChatInterface');
            const startRecordingButton = document.getElementById('startRecording');
            const stopRecordingButton = document.getElementById('stopRecording');
            const voiceStatusText = document.getElementById('voiceStatusText');
            const voiceTime = document.getElementById('voiceTime');
            const voiceMessages = document.getElementById('voiceMessages');
            const voiceAnimationOuter = document.getElementById('voiceAnimationOuter');
            
            console.log("Voice interface elements:", {
                voiceTab: voiceTab ? "Found" : "Missing",
                voiceChatInterface: voiceChatInterface ? "Found" : "Missing",
                startRecordingButton: startRecordingButton ? "Found" : "Missing",
            });
            
            // Make sure all elements are properly found
            function checkElements() {
                const elements = [
                    { name: 'chatTab', el: chatTab },
                    { name: 'voiceTab', el: voiceTab },
                    { name: 'textChatInterface', el: textChatInterface },
                    { name: 'voiceChatInterface', el: voiceChatInterface }
                ];
                
                let allFound = true;
                elements.forEach(item => {
                    if (!item.el) {
                        console.error(`Element ${item.name} not found!`);
                        allFound = false;
                    }
                });
                
                return allFound;
            }
            
            // Switch to text chat interface
            function switchToTextChat() {
                if (!checkElements()) {
                    console.error("Elements not found for switching to text chat");
                    return;
                }
                
                chatTab.classList.add('active');
                voiceTab.classList.remove('active');
                textChatInterface.classList.add('active');
                voiceChatInterface.classList.remove('active');
                console.log('Switched to text chat');
                
                // Cancel any ongoing speech
                if (window.speechSynthesis) {
                    window.speechSynthesis.cancel();
                }
            }
            
            // Switch to voice chat interface
            function switchToVoiceChat() {
                if (!checkElements()) {
                    console.error("Elements not found for switching to voice chat");
                    return;
                }
                
                voiceTab.classList.add('active');
                chatTab.classList.remove('active');
                voiceChatInterface.classList.add('active');
                textChatInterface.classList.remove('active');
                console.log('Switched to voice chat');
            }
            
            // Event listeners for tab switching
            chatTab.addEventListener('click', function(e) {
                e.preventDefault();
                switchToTextChat();
            });
            
            voiceTab.addEventListener('click', function(e) {
                e.preventDefault();
                switchToVoiceChat();
            });
            
            // Ensure tabs are working by adding redundant event listeners
            document.getElementById('chat-tab').onclick = function(e) {
                e.preventDefault();
                switchToTextChat();
                return false;
            };
            
            document.getElementById('voice-tab').onclick = function(e) {
                e.preventDefault();
                switchToVoiceChat();
                return false;
            };
            
            // Event listener for speak button
            const speakResponseButton = document.getElementById('speakResponse');
            speakResponseButton.addEventListener('click', function() {
                // Find the last bot message in voice interface
                const botMessages = voiceMessages.querySelectorAll('.bot-message');
                if (botMessages.length > 0) {
                    const lastBotMessage = botMessages[botMessages.length - 1];
                    // Extract text content from the message
                    const textContent = lastBotMessage.textContent;
                    console.log("Speaking last response:", textContent.substring(0, 50) + "...");
                    speakText(textContent);
                } else {
                    console.log("No bot messages found to speak");
                    // Speak a default message
                    speakText("I don't have any response to speak yet. Please ask me a question first.");
                }
            });
            
            // Voice recognition variables
            let recognition;
            let recordingStartTime;
            let recordingTimer;
            let isSpeaking = false;
            
            // Initialize speech recognition if available
            function initSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognition = new SpeechRecognition();
                    recognition.continuous = true;
                    recognition.interimResults = true;
                    recognition.lang = 'en-US';
                    
                    recognition.onstart = function() {
                        voiceStatusText.textContent = 'Listening...';
                        recordingStartTime = Date.now();
                        updateRecordingTime();
                    };
                    
                    recognition.onresult = function(event) {
                        let interimTranscript = '';
                        let finalTranscript = '';
                        
                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            if (event.results[i].isFinal) {
                                finalTranscript += event.results[i][0].transcript;
                            } else {
                                interimTranscript += event.results[i][0].transcript;
                            }
                        }
                        
                        if (finalTranscript) {
                            // Send the final transcript to the chatbot
                            sendVoiceMessage(finalTranscript);
                            stopRecording();
                        } else if (interimTranscript) {
                            // Update the status with interim results
                            voiceStatusText.textContent = 'Listening: ' + interimTranscript;
                        }
                    };
                    
                    recognition.onerror = function(event) {
                        console.error('Speech recognition error:', event.error);
                        voiceStatusText.textContent = 'Error: ' + event.error;
                        stopRecording();
                    };
                    
                    recognition.onend = function() {
                        voiceStatusText.textContent = 'Ready to listen';
                        clearInterval(recordingTimer);
                    };
                    
                    return true;
                } else {
                    voiceStatusText.textContent = 'Speech recognition not supported in this browser';
                    return false;
                }
            }
            
            // Start recording voice
            startRecordingButton.addEventListener('click', function() {
                if (initSpeechRecognition()) {
                    startRecordingButton.style.display = 'none';
                    stopRecordingButton.style.display = 'flex';
                    try {
                        recognition.start();
                    } catch (error) {
                        console.error('Error starting speech recognition:', error);
                        voiceStatusText.textContent = 'Error starting voice recognition';
                    }
                } else {
                    voiceStatusText.textContent = 'Speech recognition not supported';
                }
            });
            
            // Stop recording voice
            stopRecordingButton.addEventListener('click', function() {
                stopRecording();
            });
            
            // Update the recording time
            function updateRecordingTime() {
                recordingTimer = setInterval(function() {
                    const elapsedTime = Math.floor((Date.now() - recordingStartTime) / 1000);
                    const minutes = Math.floor(elapsedTime / 60).toString().padStart(2, '0');
                    const seconds = (elapsedTime % 60).toString().padStart(2, '0');
                    voiceTime.textContent = `${minutes}:${seconds}`;
                }, 1000);
            }
            
            // Stop recording
            function stopRecording() {
                if (recognition) {
                    recognition.stop();
                }
                startRecordingButton.style.display = 'flex';
                stopRecordingButton.style.display = 'none';
                clearInterval(recordingTimer);
                voiceTime.textContent = '00:00';
            }
            
            // Send voice message to chatbot
            function sendVoiceMessage(message) {
                // Create user message element
                const userMessageDiv = document.createElement('div');
                userMessageDiv.className = 'chat-message user-message';
                userMessageDiv.textContent = message;
                voiceMessages.appendChild(userMessageDiv);
                voiceMessages.scrollTop = voiceMessages.scrollHeight;
                
                // Process normally through the sendMessage function
                sendMessage(message);
            }
            
            // Voice synthesis functionality
            let speechSynthesis = window.speechSynthesis;
            let voiceSpeaking = false;
            
            // Function to speak text using speech synthesis with user interaction
            function speakText(text) {
                // Check if speech synthesis is available
                if ('speechSynthesis' in window) {
                    // Cancel any ongoing speech
                    speechSynthesis.cancel();
                    
                    // Activate animation
                    voiceAnimationOuter.classList.add('voice-animation-active');
                    voiceStatusText.innerHTML = 'Talking <span class="talking-dot"></span><span class="talking-dot"></span><span class="talking-dot"></span>';
                    voiceStatusText.classList.add('talking');
                    
                    // Log to help diagnose issues
                    console.log("Attempting to speak:", text.substring(0, 50) + "...");
                    
                    // Create a new SpeechSynthesisUtterance
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Configure the utterance
                    utterance.volume = 1; // 0 to 1
                    utterance.rate = 1.0; // 0.1 to 10
                    utterance.pitch = 1.0; // 0 to 2
                    utterance.lang = 'en-US';
                    
                    // Handle voice loading more consistently across browsers
                    // Some browsers load voices synchronously, others asynchronously
                    let voices = [];
                    
                    function loadVoicesAndSpeak() {
                        voices = window.speechSynthesis.getVoices();
                        console.log("Available voices:", voices.length);
                        
                        // Select and set voice if available
                        let selectedVoice = selectVoice(voices);
                        if (selectedVoice) {
                            utterance.voice = selectedVoice;
                            console.log("Set voice to:", selectedVoice.name);
                        } else {
                            console.log("No suitable voice found");
                        }
                        
                        // Start speaking
                        startSpeaking(utterance);
                    }
                    
                    // Compatibility check - Chrome requires the onvoiceschanged event
                    if (window.speechSynthesis.onvoiceschanged !== undefined) {
                        // For browsers that load voices asynchronously (like Chrome)
                        window.speechSynthesis.onvoiceschanged = loadVoicesAndSpeak;
                        
                        // Also attempt to get voices immediately (in case they're already loaded)
                        voices = window.speechSynthesis.getVoices();
                        if (voices.length > 0) {
                            console.log("Voices already loaded:", voices.length);
                            loadVoicesAndSpeak();
                        }
                    } else {
                        // For browsers that load voices synchronously (like Firefox)
                        loadVoicesAndSpeak();
                    }
                    
                    function selectVoice(voices) {
                        // Log all voices to debug
                        voices.forEach((v, i) => {
                            console.log(`Voice ${i}: ${v.name} (${v.lang})`);
                        });
                        
                        // First try to find specific good voices
                        let voice = voices.find(v => 
                            v.name.includes('Google') && v.name.includes('English') ||
                            v.name.includes('Microsoft') && v.name.includes('David') ||
                            v.name.includes('Samantha') ||
                            v.name.includes('Daniel')
                        );
                        
                        // If no specific voice found, use the first English voice
                        if (!voice) {
                            voice = voices.find(v => v.lang.includes('en-'));
                        }
                        
                        // If still no voice, use the default (first) voice
                        if (!voice && voices.length > 0) {
                            voice = voices[0];
                        }
                        
                        console.log("Selected voice:", voice ? voice.name : "None available");
                        return voice;
                    }
                    
                    function startSpeaking(utterance) {
                        console.log("Starting speech...");
                        
                        // Reset speech synthesis to clear any previous state
                        window.speechSynthesis.cancel();
                        
                        // Set up event handlers
                        utterance.onstart = function(event) {
                            voiceSpeaking = true;
                            console.log('Speech started successfully', event);
                            // Make sure animation is active
                            voiceAnimationOuter.classList.add('voice-animation-active');
                        };
                        
                        utterance.onend = function(event) {
                            voiceSpeaking = false;
                            console.log('Speech ended', event);
                            // End animation
                            voiceAnimationOuter.classList.remove('voice-animation-active');
                            voiceStatusText.textContent = 'Ready to listen';
                            voiceStatusText.classList.remove('talking');
                        };
                        
                        utterance.onerror = function(event) {
                            console.error('Speech error:', event);
                            voiceSpeaking = false;
                            voiceAnimationOuter.classList.remove('voice-animation-active');
                            voiceStatusText.textContent = 'Speech error';
                            voiceStatusText.classList.remove('talking');
                            
                            // Try to recover from error
                            window.speechSynthesis.cancel();
                        };
                        
                        // Try to speak with a small delay to ensure the browser is ready
                        setTimeout(function() {
                            try {
                                // Ensure page visibility state is considered
                                if (document.visibilityState === 'visible') {
                                    console.log("Page is visible, speaking now");
                                    window.speechSynthesis.speak(utterance);
                                    console.log("Speech synthesis initiated");
                                } else {
                                    console.log("Page is not visible, requesting user interaction first");
                                    document.addEventListener('visibilitychange', function speakOnceVisible() {
                                        if (document.visibilityState === 'visible') {
                                            window.speechSynthesis.speak(utterance);
                                            document.removeEventListener('visibilitychange', speakOnceVisible);
                                        }
                                    });
                                }
                                
                                // Workaround for speech synthesis issues in various browsers
                                let resumeInterval;
                                
                                // Function to periodically resume speech to prevent it from stopping
                                function keepSpeechAlive() {
                                    // Check if synthesis is still active
                                    if (window.speechSynthesis.speaking) {
                                        console.log("Keeping speech alive...");
                                        window.speechSynthesis.pause();
                                        window.speechSynthesis.resume();
                                    } else {
                                        // Speech has finished naturally, clean up
                                        clearInterval(resumeInterval);
                                        console.log("Speech completed, stopping keep-alive interval");
                                    }
                                }
                                
                                // Start the keep-alive interval
                                resumeInterval = setInterval(keepSpeechAlive, 5000);
                                
                                // Clear the interval when speech ends
                                utterance.onend = function(event) {
                                    clearInterval(resumeInterval);
                                    voiceSpeaking = false;
                                    console.log('Speech ended successfully', event);
                                    voiceAnimationOuter.classList.remove('voice-animation-active');
                                    voiceStatusText.textContent = 'Ready to listen';
                                    voiceStatusText.classList.remove('talking');
                                };
                                
                            } catch (e) {
                                console.error("Speech synthesis error:", e);
                                voiceAnimationOuter.classList.remove('voice-animation-active');
                                voiceStatusText.textContent = 'Speech not available';
                                voiceStatusText.classList.remove('talking');
                                
                                // Fallback message with more helpful information
                                alert("Speech synthesis couldn't start. This may be due to browser restrictions or privacy settings. Try the following: 1) Click on the page first, 2) Make sure your browser allows audio playback, 3) Press the speak button again.");
                            }
                        }, 100);
                    }
                    
                    return true;
                } else {
                    console.error('Speech synthesis not supported in this browser');
                    alert("Speech synthesis is not supported in your browser.");
                    return false;
                }
            }
            
            // Add bot's voice response with animation and speech
            function addVoiceResponse(message) {
                // Start the animation
                voiceAnimationOuter.classList.add('voice-animation-active');
                
                // Update status to "Talking"
                voiceStatusText.innerHTML = 'Talking <span class="talking-dot"></span><span class="talking-dot"></span><span class="talking-dot"></span>';
                voiceStatusText.classList.add('talking');
                
                // Create bot message element
                const botMessageDiv = document.createElement('div');
                botMessageDiv.className = 'chat-message bot-message';
                
                // Format the message with tables if needed
                const formattedMessage = formatBotMessage(message);
                botMessageDiv.innerHTML = formattedMessage;
                
                voiceMessages.appendChild(botMessageDiv);
                voiceMessages.scrollTop = voiceMessages.scrollHeight;
                
                // Extract text only content from the message for speech
                const textToSpeak = message.replace(/<table[^>]*>[\s\S]*?<\/table>/gi, 'I found a data table with the information you requested.')
                                           .replace(/<[^>]*>/g, ' ')
                                           .replace(/\s+/g, ' ')
                                           .trim();
                
                // Speak the text
                const speechSuccess = speakText(textToSpeak);
                
                // If speech synthesis fails, simulate the speaking time
                if (!speechSuccess) {
                    // We'll use 100ms per character as an approximation
                    const speakingTime = Math.max(2000, message.length * 40);
                    
                    // After the "speaking" time, stop the animation
                    setTimeout(function() {
                        voiceAnimationOuter.classList.remove('voice-animation-active');
                        voiceStatusText.textContent = 'Ready to listen';
                        voiceStatusText.classList.remove('talking');
                    }, speakingTime);
                }
            }
        });
    </script>
</body>
</html>